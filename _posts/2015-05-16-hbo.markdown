---
layout: post
title:  "HBO Nordic series!"
date:   2015-05-30 14:09:37
categories: hbo series
---
<header>
<style>
@media (max-width: 600px) {
  .facet_sidebar {
    display: none;
  }
}
</style>
</header>
<script>
(function() {
var sheet = window.document.styleSheets[0];
sheet.insertRule(".item {width:16.6%;}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 2200px){.item {width:20%;}}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 1750px){.item {width:25%;}}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 1200px){.item {width:33.3%;}}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 750px){.item {width:50%;}}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 550px){.item {width:100%;}}", sheet.cssRules.length);
sheet.insertRule(".hbo-main-container .clearfix {width:99%;margin:0 0.5%;}", sheet.cssRules.length);
sheet.insertRule(".post-header {width:1026px;margin:0 auto;}", sheet.cssRules.length);
sheet.insertRule("@media screen and (max-width: 1139px){.hbo-main-container .clearfix {width:96%;margin:0 2%;}}", sheet.cssRules.length);


document.getElementsByClassName("main-container")[0].className += " hbo-main-container";

	if (!("ontouchstart" in document.documentElement)) {
		document.documentElement.className += " no-touch";
	}

    var checkReady = function(callback) {
        if (window.jQuery) {
            callback(jQuery);
        }
        else {
            window.setTimeout(function() { checkReady(callback); }, 100);
        }
    };

    checkReady(function(jQuery) {
	var seen = localStorage.seen;
	if(seen==null)seen="";
	var rating = localStorage.rating;
	var series_array = [];

	if(rating == null || rating == ""){
	   refresh();
	} else {
	    series_array = JSON.parse(rating);
	    create_table(series_array);
	    sorter();
	}

	function refresh(){
		jQuery("body").append('<div id="spinner" style="position:fixed;padding:0;margin:0;top:0;left:0;width: 100%;height: 100%;background:rgba(255,255,255,0.5);"><img src="/assets/img/ajax-loader.gif" style="position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;"></div>')
		jQuery.get('https://api-hbon.hbo.clearleap.com/cloffice/client/web/browse/f5dde064-495d-41dc-8cd7-cbb76baaf8d0',function(data){
		    var series_array = {};
		    $(data).find("item").each(function () {
			var el = $(this);
			var title = el.find("title").text();
			var guid = el.find("guid").text();
			var thumb = "";
			el.children("media\\:thumbnail").each(function(){
				if($(this).attr("profile") == "NORDIC-POSTER"){
					thumb = $(this).attr("url").replace("https","http");
				}
			});

			series_array[title] = {"rating":null,"guid":guid,"thumb":thumb};
		    });
		    create_table(series_array);
		    hboloaded();
		});
	}

	function create_table(series_array){
		for(var title in series_array){
		   if(seen.search(title+";") == -1){
		      var imdb = series_array[title]["rating"];
		      var guid = series_array[title]["guid"];
		      var thumb = series_array[title]["thumb"];
		      jQuery("#hbotable").append('<li class="item"'+((imdb!=null)?' data-rating="'+imdb+'"':'')+((guid!=null)?' data-guid="'+guid+'"':'')+' style="float:left;"><div style="position:relative"><img src="'+thumb+'" class="image" style="width:100%;"><span class="seen" style="right: 15px; top: 6px; color: red; cursor: pointer; position: absolute; color: red;cursor:pointer;">x</span></img><div><a href="https://se.hbonordic.com/series/'+title.replace(" ","-").toLowerCase()+'/'+guid+'" class="hbotitle" style="color: #292D32;text-decoration: none;margin-left:10%;width:70%;height:78px;display:block;float:left;">'+title+'</a><span class="imdbrating" style="float:right;margin-right:10%;max-width:10%;color: #292D32;">'+((imdb!=null)?imdb:'')+'</span></div></div></li>');	
		   }
		}
	}


	function hboloaded(){
		var $title = jQuery('.hbotitle');
		var i = 0;
		$title.each(function(){
		    var $this = jQuery(this);
		    var data = {
		        't':$this.html().trim().replace("&amp;", "&"),
		        'plot':'short',
			'type':'series',
		        'r':'json'
		    }
		    $this.parent().parent().find('.imdbrating').html('<img src="/assets/img/ajax-loader.gif">');
		    jQuery.get('http://www.omdbapi.com/',
		               data,
		               function(response){
				   $parent = $this.parents(".item");
		                   var rating = 0;
		                   if(response.Response == "True" && jQuery.isNumeric(response.imdbRating)){
		                      rating = response.imdbRating;
		                   }
	
		                   $parent.attr('data-rating',rating).find('.imdbrating').html(rating);

		                   i++;
		                   if(i == $title.length){
		                      sorter();
				      store();
				      jQuery("#spinner").remove();
		                   }
		               },
		               'json');
		});
	}

        function sorter(){
	    jQuery("#sortimdb").click(sort_imdb);
	    jQuery("#sortname").click(sort_name);

	    jQuery(".seen").click(function(){
	        seen += jQuery(this).parent().find('.hbotitle').html() + ";";
	        if(localStorage.seen!=null)localStorage.removeItem("seen");
	        localStorage.seen=seen;
	        jQuery(this).parents(".item").remove();
		make_zebra();
	    });

	    jQuery("#refresh").click(function(){
		jQuery(".item").remove();
		refresh();
		store();
		return false;
	    });

	    jQuery(".no-touch .item").find(".seen").css("visibility","hidden");
	    jQuery(".no-touch .item").hover(function(){$(this).find(".seen").css("visibility","visible");},function(){$(this).find(".seen").css("visibility","hidden");});

	    sort_imdb();
	    make_zebra();
        };

	function store(){
	    var data = {};
	    jQuery(".item").each(function(){
		var $this = jQuery(this);
		var title = $this.find(".hbotitle").text();
		var rating = $this.attr("data-rating");
		var guid = $this.attr("data-guid");
		var thumb = $this.find("img").attr("src");
		data[title] = {"rating":rating,"guid":guid,"thumb":thumb};
	    });
	    if(localStorage.rating!=null)localStorage.removeItem("rating");
	    localStorage.rating=JSON.stringify(data);
	}

	function sort_imdb(){
  	  jQuery(".item").sort(function(a,b){
            return b.dataset.rating - a.dataset.rating; 
          }).appendTo("#hbotable");
	  make_zebra();
	}

	function sort_name(){
	  jQuery(".item").sort(function(a,b){
                    var A = a.getElementsByClassName("hbotitle")[0].innerHTML.toLowerCase();
		    var B = b.getElementsByClassName("hbotitle")[0].innerHTML.toLowerCase();
		    if (A < B){
		        return -1;
		    }else if (A > B){
		        return  1;
		    }else{
		        return 0;
		    }
                }).appendTo("#hbotable");
		make_zebra();
	}

	function make_zebra(){
	  $("tr").attr("style","");
	  $("tr:odd").attr("style","background:#ccc");
	}
    });
})();
</script>

<button id="refresh">refresh</button>

<ul id="hbotable" style="width:100%;padding:0;margin-bottom:100px;list-style:none">
    <li style="float:left;width:100%">
	<div id="sortname" style="cursor:pointer;float:left;">Series</div>
        <div id="sortimdb" style="cursor:pointer;float:right">Imdb</div>
    <li>
</ul>
